<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MoodMap</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --accent:#a78bfa;
  --accent2:#22d3ee;
  --accent-soft:rgba(167,139,250,0.26);

  --text:#e5e7eb;
  --muted:rgba(255,255,255,0.66);

  --bg1:#0ea5e9;
  --bg2:#0b1020;
  --bg3:#a78bfa;

  --particle:200,230,255;

  --glass:rgba(255,255,255,0.06);
  --glass2:rgba(255,255,255,0.04);
  --border:rgba(255,255,255,0.12);
  --border2:rgba(255,255,255,0.18);
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  background:#000;
  overflow-x:hidden;
}

/* ===========================================================
   âœ… FULL MOOD BACKGROUND SCENES (not just tint)
   =========================================================== */

.moodScene{
  position:fixed;
  inset:0;
  z-index:-11;
  pointer-events:none;
  opacity:1;
  transition: opacity 900ms cubic-bezier(.2,1,.2,1);
}

.sceneLayer{
  position:absolute;
  inset:0;
  opacity:0;
  transition: opacity 950ms cubic-bezier(.2,1,.2,1);
}

/* WORK */
.scene-work{
  background:
    radial-gradient(circle at 18% 18%, rgba(56,189,248,0.22), transparent 55%),
    radial-gradient(circle at 72% 42%, rgba(96,165,250,0.18), transparent 60%),
    radial-gradient(circle at 52% 82%, rgba(34,211,238,0.12), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0.9), rgba(7,12,30,1));
}

/* DATE */
.scene-date{
  background:
    radial-gradient(circle at 18% 24%, rgba(251,113,133,0.20), transparent 54%),
    radial-gradient(circle at 68% 28%, rgba(167,139,250,0.22), transparent 56%),
    radial-gradient(circle at 52% 86%, rgba(147,51,234,0.14), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0.90), rgba(14,3,20,1));
}

/* QUICK BITE */
.scene-quick{
  background:
    radial-gradient(circle at 14% 18%, rgba(34,211,238,0.22), transparent 55%),
    radial-gradient(circle at 82% 62%, rgba(56,189,248,0.20), transparent 60%),
    radial-gradient(circle at 54% 90%, rgba(14,165,233,0.12), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0.90), rgba(2,10,18,1));
}

/* BUDGET */
.scene-budget{
  background:
    radial-gradient(circle at 18% 18%, rgba(148,163,184,0.14), transparent 55%),
    radial-gradient(circle at 72% 54%, rgba(100,116,139,0.14), transparent 60%),
    radial-gradient(circle at 54% 90%, rgba(203,213,225,0.07), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0.92), rgba(7,10,14,1));
}

/* active scene */
body.mood-work .scene-work{opacity:1}
body.mood-date .scene-date{opacity:1}
body.mood-quick_bite .scene-quick{opacity:1}
body.mood-budget .scene-budget{opacity:1}

/* canvas particles */
#particles{
  position:fixed;
  inset:0;
  z-index:-8;
  pointer-events:none;
  opacity:0.55;
  transition: opacity .4s ease;
}

.noise{
  position:fixed;
  inset:0;
  z-index:-7;
  pointer-events:none;
  opacity:0.025;
  background-image:url("https://grainy-gradients.vercel.app/noise.svg");
  mix-blend-mode: overlay;
}

/* keep old element (script still uses it) */
.moodGradient{
  position:fixed;
  inset:0;
  z-index:-10;
  background:#000;
  opacity:0;
  pointer-events:none;
}

/* main */
.app{
  max-width:1180px;
  margin:auto;
  padding:46px 26px 130px;
}

/* ================= Header ================= */
header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:14px;
  margin-bottom:18px;
  flex-wrap:wrap;
}

.brand{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.title{
  font-size:32px;
  font-weight:1000;
  letter-spacing:-0.6px;
}
.subtitle{
  color:rgba(255,255,255,0.62);
  font-size:13px;
  margin-top:0px;
}

/* âœ… right actions */
.userbox{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
  justify-content:flex-end;
}

.welcomeChip{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background: rgba(255,255,255,0.05);
  font-size:13px;
  color:rgba(255,255,255,0.88);
}

/* ================= Top buttons ================= */
.topBtn{
  color:white;
  text-decoration:none;
  font-weight:1000;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.05);
  transition: transform .16s ease, box-shadow .16s ease, border .16s ease;
  cursor:pointer;
}
.topBtn:hover{
  transform: translateY(-2px);
  border-color: var(--border2);
  box-shadow: 0 18px 60px rgba(0,0,0,0.60);
}

.logoutBtn{
  color:white;
  text-decoration:none;
  font-weight:1000;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(239,68,68,0.14);
  transition: transform .16s ease, box-shadow .16s ease;
}
.logoutBtn:hover{
  transform: translateY(-2px);
  box-shadow: 0 18px 60px rgba(239,68,68,0.18);
}

/* ================= Search Users ================= */
.searchWrap{
  position:relative;
}

.userSearch{
  width:270px;
  background: rgba(255,255,255,0.05);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 12px 10px 36px;
  border-radius:999px;
  font-size:13px;
  outline:none;
  transition: border .2s ease, box-shadow .2s ease;
}
.userSearch:focus{
  border-color: rgba(255,255,255,0.26);
  box-shadow: 0 25px 90px rgba(167,139,250,0.12);
}

.searchIcon{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  opacity:.7;
  font-size:14px;
  pointer-events:none;
}

.searchDrop{
  position:absolute;
  right:0;
  top:46px;
  width:380px;
  max-width:90vw;
  border-radius:20px;
  border:1px solid rgba(255,255,255,0.16);
  background: linear-gradient(180deg, rgba(25,30,45,0.94), rgba(10,12,20,0.86));
  backdrop-filter: blur(18px);
  box-shadow: 0 50px 150px rgba(0,0,0,0.80);
  overflow:hidden;
  display:none;
  z-index:200;
}

/* ================= Panel ================= */
.panel{
  margin-top:18px;
  border-radius:24px;
  padding:18px;
  border:1px solid rgba(255,255,255,0.14);
  background: rgba(15,18,30,0.88);
  backdrop-filter: blur(14px);
  box-shadow:
    0 30px 120px rgba(0,0,0,0.45),
    0 1px 0 rgba(255,255,255,0.05) inset;
}

.controls{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
}

select, input[type="text"]{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  color:var(--text);
  padding:12px 14px;
  border-radius:16px;
  font-size:14px;
  outline:none;
}

input[type="text"]{width:340px}

button{
  margin-left:auto;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;
  color:white;
  padding:12px 18px;
  border-radius:16px;
  font-weight:1000;
  cursor:pointer;
  transition: transform .16s ease, box-shadow .16s ease;
}
button:hover{
  transform:translateY(-2px);
  box-shadow: 0 18px 70px var(--accent-soft);
}
button:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
  transform:none;
}

/* results */
.results{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:18px;
  margin-top:22px;
}

.card{
  position:relative;
  overflow:hidden;
  border-radius:22px;
  padding:18px;
  min-height:190px;

  background:
    linear-gradient(
      180deg,
      rgba(255,255,255,0.04),
      rgba(255,255,255,0.01)
    ),
    rgba(18,22,36,0.88);

  border:1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(16px);

  box-shadow:
    0 14px 45px rgba(0,0,0,0.45),
    0 1px 0 rgba(255,255,255,0.04) inset;

  /* entrance only */
  opacity:0;
  animation: cardIn 420ms cubic-bezier(.2,.8,.2,1) forwards;
  animation-fill-mode: both;
  will-change: transform;

  transition:
    transform .28s cubic-bezier(.2,.8,.2,1),
    box-shadow .28s cubic-bezier(.2,.8,.2,1),
    border-color .28s ease;
}


@keyframes cardIn{
  from{
    transform: translateY(14px) scale(0.985);
    opacity:0;
  }
  to{
    transform:none;
    opacity:1;
  }
}


/* stagger */
.card:nth-child(1){ animation-delay:0ms }
.card:nth-child(2){ animation-delay:40ms }
.card:nth-child(3){ animation-delay:80ms }
.card:nth-child(4){ animation-delay:120ms }
.card:nth-child(5){ animation-delay:160ms }
.card:nth-child(6){ animation-delay:200ms }

/* hover = float, not jump */
.card:hover{
  transform: translateY(-3px) scale(1.002);
  border-color: rgba(167,139,250,0.35);

  box-shadow:
    0 28px 80px rgba(0,0,0,0.55),
    0 0 0 1px rgba(167,139,250,0.22);
}



/* actions */
.actions{
  position:absolute;
  right:14px;
  top:14px;
  display:flex;
  gap:10px;
}

.iconBtn{
  width:36px;height:36px;border-radius:14px;
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(0,0,0,0.32);
  color:white;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  font-weight:1000;
  transition: transform .16s ease, border .16s ease;
}
.iconBtn:hover{
  transform: translateY(-2px);
  border-color: rgba(255,255,255,0.24);
}
.iconBtn.pinned{border-color: var(--accent)}

/* skeleton */
.skeleton{
  border-radius:24px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.05);
  height:190px;
  position:relative;
  overflow:hidden;
}
.skeleton::after{
  content:"";
  position:absolute; inset:0;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.09),transparent);
  transform:translateX(-100%);
  animation:shimmer 1.4s infinite;
}
@keyframes shimmer{to{transform:translateX(100%)}}

/* ================= Premium Place Modal ================= */
#modalBackdrop{
  position: fixed;
  inset: 0;
  z-index: 9998;
  opacity: 0;
  pointer-events: none;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  transition: opacity 240ms cubic-bezier(.2,1,.2,1);
}
#modalBackdrop.active{
  opacity: 1;
  pointer-events: auto;
}
#modal{
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
  z-index: 9999;

  width: min(980px, 92vw);
  max-height: 86vh;
  overflow: auto;

  border-radius: 26px;
  border: 1px solid rgba(255,255,255,0.18);

  background: linear-gradient(180deg, rgba(20,22,35,0.82), rgba(0,0,0,0.72));
  box-shadow:
    0 70px 200px rgba(0,0,0,0.82),
    0 1px 0 rgba(255,255,255,0.05) inset;

  opacity: 0;
  pointer-events: none;

  transition: transform 260ms cubic-bezier(.2,1.05,.2,1),
              opacity 260ms cubic-bezier(.2,1.05,.2,1);

  will-change: transform, opacity;
}
#modal.active{
  opacity: 1;
  pointer-events: auto;
}

#modalInner{
  animation: modalInnerIn 360ms cubic-bezier(.2,.8,.2,1);
}

@keyframes modalInnerIn{
  from{
    opacity:0;
    transform: translateY(10px) scale(0.985);
  }
  to{
    opacity:1;
    transform:none;
  }
}


/* ===========================================================
   âœ… Floating Follow Requests Panel (Bottom-right corner)
   =========================================================== */
#reqBackdrop{
  display:none; /* âœ… remove full screen overlay */
}

#reqModal{
  position: fixed;
  right: 22px;
  bottom: 22px;
  z-index: 12000;

  width: min(420px, calc(100vw - 44px));
  max-height: 58vh;
  overflow: auto;

  border-radius: 22px;
  border: 1px solid rgba(255,255,255,0.16);
  background: linear-gradient(180deg, rgba(20,22,35,0.92), rgba(0,0,0,0.75));
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);

  box-shadow: 0 40px 140px rgba(0,0,0,0.82);

  opacity: 0;
  pointer-events: none;
  transform: translateY(16px) scale(0.98);
  transition: opacity 240ms cubic-bezier(.2,1,.2,1),
              transform 240ms cubic-bezier(.2,1,.2,1);
}
#reqModal.active{
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0) scale(1);
}

.reqInner{ padding: 14px 14px 12px; }
.reqTitle{ margin:0; font-size:15px; font-weight:1000; }
.reqSub{ margin-top:6px; font-size:12px; opacity:.70; }

.reqList{ margin-top:12px; }

.smallBtn{
  border:none;
  color:white;
  font-weight:1000;
  cursor:pointer;
  border-radius:14px;
  padding:9px 12px;
  background: rgba(255,255,255,0.08);
}
.smallBtn.primary{
  background: linear-gradient(135deg,var(--accent),var(--accent2));
}
.smallBtn.danger{
  background: rgba(239,68,68,0.18);
  border:1px solid rgba(239,68,68,0.20);
}
.smallBtn.reqClose{
  margin-left:auto;
  width:38px;
  height:38px;
  display:grid;
  place-items:center;
  padding:0;
  border-radius:14px;
}

.reqItem{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;

  padding:12px;
  border-radius:18px;

  border:1px solid rgba(255,255,255,0.10);
  background: rgba(0,0,0,0.20);
  margin-bottom:10px;
}
.reqUser{ font-weight:1000; font-size:13px; }
.reqMeta{ font-size:12px; opacity:.68; margin-top:4px; }
.reqBtns{ display:flex; gap:10px; }


/* ===========================================================
   ðŸ†• SPLIT GLASS PLACE MODAL (Map + Details)
   =========================================================== */

.modalInner.splitModal{
  display:grid;
  grid-template-columns: 1.15fr 0.85fr;
  padding:0;
  overflow:hidden;
}

/* LEFT SIDE â€“ MAP */
.splitMap{
  position:relative;
  min-height:440px;
  background: rgba(0,0,0,0.35);
}

.splitMap iframe{
  width:100%;
  height:100%;
  border:none;

  filter:
    saturate(1.15)
    contrast(0.92)
    brightness(1.06);

  transform: scale(1.02);
}

/* cartoon-ish soft overlay */
.splitMap::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;

  background:
    radial-gradient(
      circle at 20% 20%,
      rgba(255,255,255,0.10),
      transparent 45%
    ),
    linear-gradient(
      180deg,
      rgba(255,255,255,0.05),
      rgba(0,0,0,0.22)
    );
}

/* RIGHT SIDE â€“ DETAILS */
.splitDetails{
  padding:22px 22px 20px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

/* HEADER */
.splitHeader{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  padding-bottom:14px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}

.splitTitle{
  font-size:22px;
  font-weight:1000;
  letter-spacing:-0.4px;
}


.splitMeta{
  margin-top:6px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.badge{
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  border:1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
}

/* INFO ROWS */
.infoRow{
  display:flex;
  gap:12px;
  align-items:flex-start;

  padding:12px;
  border-radius:16px;

  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.04),
    rgba(0,0,0,0.22)
  );

  border:1px solid rgba(255,255,255,0.12);
  box-shadow:
    0 10px 30px rgba(0,0,0,0.35),
    0 1px 0 rgba(255,255,255,0.04) inset;

  font-size:13px;
  transition: transform .18s ease, box-shadow .18s ease;
}

.infoRow:hover{
  transform: translateY(-1px);
  box-shadow:
    0 18px 45px rgba(0,0,0,0.45),
    0 1px 0 rgba(255,255,255,0.06) inset;
}


.infoIcon{
  width:28px;
  height:28px;
  border-radius:10px;

  display:grid;
  place-items:center;

  background: rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.10);
}

/* ACTION BAR */
.splitActions{
  margin-top:auto;
  display:flex;
  gap:12px;
}

.splitActions button{
  flex:1;
  border-radius:14px;
  padding:12px;
  font-weight:1000;
}

/* ===========================================================
   âœ… FIXED SAVED PLACES ROW (PILL STYLE)
=========================================================== */

#savedWrap{
  margin-top: 26px;
}

/* section wrapper */
.savedSection{
  margin-bottom: 18px;
}

/* header */
.savedSectionTitle{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
  font-size:13px;
  font-weight:900;
  opacity:.9;
}

/* horizontal scroll row */
.carousel{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding-top: 4px;  
  padding-bottom:6px;
  scroll-snap-type:x mandatory;
}

.carousel::-webkit-scrollbar{
  height:6px;
}
.carousel::-webkit-scrollbar-thumb{
  background:rgba(255,255,255,0.14);
  border-radius:999px;
}

/* ðŸ”¥ THE PILL CARD */
.pinCard{
  flex:0 0 auto;
  height:56px;              /* â¬† bigger */
  padding:0 20px;           /* â¬† more breathing room */
  border-radius:16px;       /* â¬› squarer (was 999px) */

  display:flex;
  flex-direction:column;
  justify-content:center;

  background: rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(14px);

  cursor:pointer;
  white-space:nowrap;

  transition:
    transform .24s cubic-bezier(.2,.8,.2,1),
    background .24s ease,
    border-color .24s ease;
}

.pinCard:hover{
  transform:translateY(-1px);
  background: rgba(255,255,255,0.10);
  border-color: var(--accent);
}

/* text */
.pinCardTitle{
  font-size:13px;
  font-weight:900;
  line-height:1.2;
}

.pinCardMeta{
  font-size:11px;
  opacity:.65;
  margin-top:2px;
}


  .splitMap::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.06),
    inset 0 -60px 80px rgba(0,0,0,0.45);
}


/* MOBILE FALLBACK */
@media (max-width: 860px){
  .modalInner.splitModal{
    grid-template-columns: 1fr;
  }
  .splitMap{
    min-height:300px;
    border-right:1px solid rgba(255,255,255,0.10);
  }
}

</style>
</head>

<body class="mood-work">
  <!-- âœ… Full mood scenes -->
  <div class="moodScene">
    <div class="sceneLayer scene-work"></div>
    <div class="sceneLayer scene-date"></div>
    <div class="sceneLayer scene-quick"></div>
    <div class="sceneLayer scene-budget"></div>
  </div>

  <!-- keep for compatibility -->
  <div id="moodGradient" class="moodGradient"></div>

  <canvas id="particles"></canvas>
  <div class="noise"></div>

  <div class="app">
    <header>
      <div class="brand">
        <div class="title">MoodMap</div>
        <div class="subtitle">Context-aware place discovery</div>
      </div>

      <div class="userbox">
        <div class="welcomeChip">Welcome, <b>{{username}}</b></div>

        <button class="topBtn" id="myProfileBtn" title="My profile">My Profile</button>

        <button class="topBtn" id="copyProfileBtn" title="Copy profile link">Copy Link</button>

        <button class="topBtn" id="reqBtn" title="Follow requests" style="display:none">
          Requests <span id="reqCount" style="opacity:.9;"></span>
        </button>

        <a class="logoutBtn" href="/logout">Logout</a>
      </div>
    </header>

    <div class="panel">
      <div class="controls">
        <select id="mood">
          <option value="work">Work</option>
          <option value="date">Date</option>
          <option value="quick_bite">Quick Bite</option>
          <option value="budget">Budget</option>
        </select>

        <input type="text" id="searchInput" placeholder="Search places / category..." />

        <button id="findBtn" disabled>Getting locationâ€¦</button>
      </div>
    </div>

    <div id="savedWrap"></div>
    <div id="results" class="results"></div>
  </div>

  <!-- place modal -->
  <div id="modalBackdrop"></div>
  <div id="modal">
    <div id="modalInner" class="modalInner splitModal"></div>
  </div>

  <!-- follow requests floating panel -->
  <div id="reqBackdrop"></div>
  <div id="reqModal">
    <div class="reqInner">
      <div style="display:flex;gap:12px;align-items:center;">
        <div>
          <h3 class="reqTitle">Follow Requests</h3>
          <div class="reqSub">Approve or reject pending requests</div>
        </div>
        <button class="smallBtn reqClose" id="reqCloseBtn">âœ•</button>
      </div>

      <div class="reqList" id="reqList"></div>
    </div>
  </div>

  <script>window.MOODMAP_USERNAME = "{{user_username}}";</script>
  <script src="https://unpkg.com/opening_hours@3.6.0/opening_hours.min.js"></script>
  <script src="/static/script.js"></script>
</body>
</html>
